---
title: "TidyCensus"
output: html_document
date: '2022-12-07'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
install.packages(c("tidycensus", "tidyverse"))
install.packages("acs")
install.packages("DT")
install.packages("jsonlite")

```

```{r}
library(tidycensus)
library(tidyverse)
library(acs)

census_api_key("5e3ba95b31e60d07bccd54c85ace6675826e6e6f")

acs::api.key.install(key="5e3ba95b31e60d07bccd54c85ace6675826e6e6f")
```


```{r}
## Testing 

age10 <- get_decennial(geography = "county", state="MS",
                       variables = "P013001", 
                       year = 2010)

#age10

v19 <- load_variables(2019, "acs5", cache=TRUE)
#View(v19)

	
#B17010B_002
tidypov <- get_acs(geography = "county", state="MS",
                       variables = "B17010B_002", 
                       year = 2019)
#tidypov

tidypov <- get_acs(geography = "county", state="MS",
                       table = "B17001", 
                       year = 2019, output="wide")
#tidypov

MS_geo <- geo.make(state = "MS", county = "*")
pov2 <- acs.fetch(endyear=2019, span = 5, geography = MS_geo, table.number="B17001", col.names = "pretty")

#pov2

#View(tidypov)
#dflist[[3]]

#(dflist[[3]]$`Income in the past 12 months below poverty level:`/
#dflist[[3]]$Total)* 100

tidypov

```


```{r}
year <- 2020
v19 <- load_variables(year, "acs5", cache=TRUE)
subjectvars <-  load_variables(year, "acs5/subject", cache=TRUE)

getdata <- function(tablename, racetablename=tablename, returnvars=FALSE, raceavailable=TRUE, subject=FALSE) {
  if (subject) {
    subjectvars <- data.frame(filter(subjectvars, grepl(paste0(tablename,"|",racetablename), name)))
    vars <-data.frame(filter(v19, grepl(paste0(tablename,"|",racetablename), name)))
  }
  else{
    vars <- data.frame(filter(v19, grepl(paste0(tablename,"|",racetablename), name)))
  }
  
  df_all <- get_acs(geography = "county", state="MS",
                         table = tablename, 
                         year = year, output="wide")
  if (raceavailable){
    df_b <- get_acs(geography = "county", state="MS",
                           table = paste0(racetablename, "B"), 
                           year = year, output="wide")
    df_w <- get_acs(geography = "county", state="MS",
                           table = paste0(racetablename,"A"), 
                           year = year, output="wide")
    df_list <- list(df_all, df_b, df_w)
    fulldf <- df_list %>% reduce(full_join, by='GEOID')
  }
  else {
    fulldf <- df_all
  }
  tidyfulldf <- as.data.frame(fulldf)
  htmlwidgets::saveWidget(DT::datatable(vars), "vars.html")
  if (subject) {
    htmlwidgets::saveWidget(DT::datatable(subjectvars), "subjectvars.html")
  }
  if (returnvars){
    return(list(tidyfulldf, vars))
  }
  else {
    return(tidyfulldf)
  }
}

```

```{r}
tidypovdf <- getdata("B17001")
allvars <- tidypovdf %>% select(GEOID, NAME)
```

#Poverty
totalpop B17001_001, ibp: all B17001_002, ibp male B17001_003, ibp female B17001_017
above B17001_031, above male B17001_032, above female B17001_046
for white: add A after B17001, B for black

```{r}
alldems <- c("_A_A", "_A_B", "_A_W", "_M_A", "_M_B", "_M_W", "_F_A", "_F_B", "_F_W")
# IBP, IAP, 
#denominator for some of them is adding up below poverty and above poverty values to get total
tidypovdf <- tidypovdf %>% mutate( 
              IBP_A_A = 100 * B17001_002E/ B17001_001E,
              IBP_A_B = 100 *B17001B_002E/B17001B_001E,
              IBP_A_W = 100 *B17001A_002E/B17001A_001E,
              IBP_M_A = 100 *B17001_003E/ (B17001_003E+B17001_032E),
              IBP_M_B = 100 *B17001B_003E/ (B17001B_003E+B17001B_032E),
              IBP_M_W = 100 *B17001A_003E/ (B17001A_003E+B17001A_032E),
              IBP_F_A = 100 *B17001_017E/ (B17001_017E+B17001_046E),
              IBP_F_B = 100 *B17001B_017E/ (B17001B_017E+B17001B_046E),
              IBP_F_W = 100 *B17001A_017E/ (B17001A_017E+B17001A_046E),
              IAP_A_A = 100 - IBP_A_A,
              IAP_A_B = 100 - IBP_A_B,
              IAP_A_W = 100 - IBP_A_W,
              IAP_M_A = 100 - IBP_M_A,
              IAP_M_B = 100 - IBP_M_B,
              IAP_M_W = 100 - IBP_M_W,
              IAP_F_A = 100 - IBP_F_A,
              IAP_F_B = 100 - IBP_F_B,
              IAP_F_W = 100 - IBP_F_W,
              )
allvars <- full_join(allvars, tidypovdf %>% select(GEOID, IBP_A_A, IBP_A_B, IBP_A_W, IBP_M_A, IBP_M_B, IBP_M_W, IBP_F_A, IBP_F_B, IBP_F_W), by="GEOID")
#allvars <- full_join(allvars, tidypovdf %>% select(matches("IAP|GEOID")), by="GEOID")
```

#Median Earnings
B20017_001 general, _002 male general, _003 male ft, 004 male not ft
005 female general, 006 female ft, 007 female not ft
- no race for ft and non ft (so no A_B, A_W)
- also no everyone for ft and nonft, app crashes currently (A_A)
This is really just a matter of renaming variables to fit our current structure
```{r}
tidymedearningsdf <- getdata("B20017")

tidymedearningsdf <- tidymedearningsdf %>% rename( 
  Median_Earnings_A_A = B20017_001E,
  Median_Earnings_A_B = B20017B_001E, 
  Median_Earnings_A_W = B20017A_001E,
  Median_Earnings_M_A = B20017_002E,
  Median_Earnings_M_B = B20017B_002E,
  Median_Earnings_M_W = B20017A_002E,
  Median_Earnings_F_A = B20017_005E,
  Median_Earnings_F_B = B20017B_005E,
  Median_Earnings_F_W = B20017A_005E,
  FT_Median_Earnings_M_A = B20017_003E,
  FT_Median_Earnings_M_B = B20017B_003E,
  FT_Median_Earnings_M_W = B20017A_003E,
  FT_Median_Earnings_F_A = B20017_006E,
  FT_Median_Earnings_F_B = B20017B_006E,
  FT_Median_Earnings_F_W = B20017A_006E,
  Other_Median_Earnings_M_A = B20017_004E,
  Other_Median_Earnings_M_B = B20017B_004E,
  Other_Median_Earnings_M_W = B20017A_004E,
  Other_Median_Earnings_F_A = B20017_007E,
  Other_Median_Earnings_F_B = B20017B_007E,
  Other_Median_Earnings_F_W = B20017A_007E
)

tidymedearningsdf <- tidymedearningsdf %>% mutate(
  GenderWageGap_A_A = 100*(FT_Median_Earnings_F_A/FT_Median_Earnings_M_A))

#tidymedearningsdf$GenderWageGap_A_A

allvars <- full_join(allvars, tidymedearningsdf %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")
```

##Education
Less_than_high_school_diploma c...003 / 
A_B, A_W, M_B, M_W, F_B, F_W, 
```{r}
tidyedudf <- getdata("B15002", "C15002")

lessthanhs_m_vars <- paste0("B15002_00", 3:9, "E")
lessthanhs_m_vars <- append(lessthanhs_m_vars, "B15002_010E")
lessthanhs_f_vars <- paste0("B15002_0", 20:27, "E")
combined <- append(lessthanhs_m_vars, lessthanhs_f_vars)

tidyedudf <- tidyedudf %>% mutate(
  #male less than + female less than all over total population 25 years and over
  Less_than_high_school_diploma_A_B = (100 * (C15002B_003E + C15002B_008E))/C15002B_001E,
  Less_than_high_school_diploma_A_W = (100 * (C15002A_003E + C15002A_008E))/C15002A_001E,
  Less_than_high_school_diploma_M_B = (100 * C15002B_003E)/C15002B_002E,
  Less_than_high_school_diploma_M_W = (100 * C15002A_003E)/C15002A_002E,
  Less_than_high_school_diploma_F_B = (100 * C15002B_008E)/C15002B_007E,
  Less_than_high_school_diploma_F_W = (100 * C15002A_008E)/C15002A_007E,
  "High_school_graduate_(includes_equivalency)_A_B" = (100 * (C15002B_004E + C15002B_009E))/C15002B_001E,
  "High_school_graduate_(includes_equivalency)_A_W" = (100 * (C15002A_004E + C15002A_009E))/C15002A_001E,
  "High_school_graduate_(includes_equivalency)_M_B" = (100 * C15002B_004E)/C15002B_002E,
  "High_school_graduate_(includes_equivalency)_M_W" = (100 * C15002A_004E)/C15002A_002E,
  "High_school_graduate_(includes_equivalency)_F_B" = (100 * C15002B_009E)/C15002B_007E,
  "High_school_graduate_(includes_equivalency)_F_W" = (100 * C15002A_009E)/C15002A_007E,
  Some_college_or_associates_degree_A_B = (100 * (C15002B_005E + C15002B_010E))/C15002B_001E,
  Some_college_or_associates_degree_A_W = (100 * (C15002A_005E + C15002A_010E))/C15002A_001E,
  Some_college_or_associates_degree_M_B = (100 * C15002B_005E)/C15002B_002E,
  Some_college_or_associates_degree_M_W = (100 * C15002A_005E)/C15002A_002E,
  Some_college_or_associates_degree_F_B = (100 * C15002B_010E)/C15002B_007E,
  Some_college_or_associates_degree_F_W = (100 * C15002A_010E)/C15002A_007E,
  Bachelors_degree_or_higher_A_B = (100 * (C15002B_006E + C15002B_011E))/C15002B_001E,
  Bachelors_degree_or_higher_A_W = (100 * (C15002A_006E + C15002A_011E))/C15002A_001E,
  Bachelors_degree_or_higher_M_B = (100 * C15002B_006E)/C15002B_002E,
  Bachelors_degree_or_higher_M_W = (100 * C15002A_006E)/C15002A_002E,
  Bachelors_degree_or_higher_F_B = (100 * C15002B_011E)/C15002B_007E,
  Bachelors_degree_or_higher_F_W = (100 * C15002A_011E)/C15002A_007E,
  ##now for general (non race vars)
  Less_than_high_school_diploma_A_A = (100 * rowSums(across(all_of(combined))))/B15002_001E ,
  Less_than_high_school_diploma_M_A = (100 * rowSums(across(all_of(lessthanhs_m_vars))))/B15002_002E ,
  Less_than_high_school_diploma_F_A = (100 * rowSums(across(all_of(lessthanhs_f_vars))))/B15002_019E ,
  "High_school_graduate_(includes_equivalency)_A_A" = (100 * (B15002_011E + B15002_028E)/B15002_001E),
  "High_school_graduate_(includes_equivalency)_M_A" = (100 * B15002_011E)/B15002_002E,
  "High_school_graduate_(includes_equivalency)_F_A" = (100 * B15002_028E)/B15002_019E,
  Some_college_or_associates_degree_A_A = (100 * (B15002_012E+B15002_013E+B15002_014E +   B15002_029E+B15002_030E+B15002_031E ))/B15002_001E,
  Some_college_or_associates_degree_M_A = (100 * (B15002_012E+B15002_013E+B15002_014E ))/B15002_002E,
  Some_college_or_associates_degree_F_A = (100 * (B15002_029E+B15002_030E+B15002_031E))/B15002_019E,
  Bachelors_degree_or_higher_A_A = (100 * (B15002_015E+B15002_016E+B15002_017E+B15002_018E + B15002_032E+B15002_033E+B15002_034E + B15002_035E))/B15002_001E,
  Bachelors_degree_or_higher_M_A = (100 * (B15002_015E+B15002_016E+B15002_017E+B15002_018E ))/B15002_002E,
  Bachelors_degree_or_higher_F_A = (100 * (B15002_032E+B15002_033E+B15002_034E + B15002_035E ))/B15002_019E
)

allvars <- full_join(allvars, tidyedudf %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")

```

## Health Insurance

```{r}
resultlist <- getdata("B27001", "C27001", TRUE)
tidyhealthdf <- resultlist[[1]]
tidyhealthdf <- tidyhealthdf %>% select("GEOID" | ends_with("E")) %>% select(!"NAME")

##Getting all relevant vars into lists
vars <- resultlist[[2]]

all_m <- (vars %>% filter(str_detect(label, "With"), str_detect(label, "Male"), str_detect(name, "B27001")))$name
all_f <- (vars %>% filter(str_detect(label, "With"), str_detect(label, "Female"), str_detect(name, "B27001")))$name
all_with <- (vars %>% filter(str_detect(label, "With"), str_detect(name, "B27001")))$name
all_b <- (vars %>% filter(str_detect(label, "With"), str_detect(name, "C27001B")))$name
all_w <- (vars %>% filter(str_detect(label, "With"), str_detect(name, "C27001A")))$name

#Add E to the end of everything
paste_e <- function(x,y) paste0(x,"E")

result <- lapply(list(all_with, all_m, all_f, all_b, all_w), paste_e)

#above 53 and 56 for all female, 25 and 28 for male
#total 52 and 55 for female, 24 and 27 for male
above_m <- paste0("B27001_0", c(25, 28), "E")
above_f <- paste0("B27001_0", c(53, 56), "E")
above_all <- append(above_m, above_f)
denominatorabove_m <- paste0("B27001_0", c(24, 27), "E")
denominatorabove_f <- paste0("B27001_0", c(52, 55), "E")
denominatorabove_all <- append(denominatorabove_m, denominatorabove_f)

tidyhealthdf <- tidyhealthdf %>% mutate(
  HealthInsurance_A_A = (100*rowSums(across(result[[1]])))/B27001_001E,
  HealthInsurance_M_A = (100*rowSums(across(result[[2]])))/B27001_002E,
  HealthInsurance_F_A = (100*rowSums(across(result[[3]])))/B27001_030E,
  HealthInsurance_A_B = (100*rowSums(across(result[[4]])))/C27001B_001E,
  HealthInsurance_A_W = (100*rowSums(across(result[[5]])))/C27001A_001E,
  SeniorHealthInsurance_A_A = (100*rowSums(across(above_all)))/rowSums(across(denominatorabove_all)),
  SeniorHealthInsurance_M_A =(100*rowSums(across(above_m)))/rowSums(across(denominatorabove_m)),
  SeniorHealthInsurance_F_A = (100*rowSums(across(above_f)))/rowSums(across(denominatorabove_f)),
  #above for white black is 009, total people above for white black is 008
  SeniorHealthInsurance_A_B = (100*C27001B_009E)/C27001B_008E,
  SeniorHealthInsurance_A_W = (100*C27001A_009E)/C27001A_008E
)

allvars <- full_join(allvars, tidyhealthdf %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")

results <- getdata("B27003", raceavailable = FALSE, returnvars = TRUE)
publichealthdf <- results[[1]]
vars <- results[[2]]
vars

#selecting all under 65, with public coverage, and then totals for denominator
all_m <- (vars %>% filter(str_detect(label, "With"), str_detect(label, "Male"), str_detect(name, "B27003")))[1:7,]$name
all_f <- (vars %>% filter(str_detect(label, "With"), str_detect(label, "Female"), str_detect(name, "B27003")))[1:7,]$name
all_with <- append(all_m, all_f)
total_m <- (vars %>% filter(str_detect(label, "Male"),str_detect(label, "Estimate"),str_detect(label, "years"),!str_detect(label,"coverage"),str_detect(name, "B27003")))[1:7,]$name
total_f <- (vars %>% filter(str_detect(label, "Female"),str_detect(label, "Estimate"),str_detect(label, "years"),!str_detect(label,"coverage"),str_detect(name, "B27003")))[1:7,]$name
total <- append(total_m, total_f)
result <- lapply(list(all_with, all_m, all_f, total, total_m, total_f), paste_e)

publichealthdf <- publichealthdf %>% mutate(
  PublicHealthInsurance_A_A = (100*rowSums(across(result[[1]])))/rowSums(across(result[[4]])),
  PublicHealthInsurance_M_A = (100*rowSums(across(result[[2]])))/rowSums(across(result[[5]])),
  PublicHealthInsurance_F_A = (100*rowSums(across(result[[3]])))/rowSums(across(result[[6]]))
)

allvars <- full_join(allvars, publichealthdf %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")

```

```{r}
rentdf <- getdata("B25064", raceavailable = FALSE)
rentdf <- rentdf %>% rename (
  MedianRent_A_A = B25064_001E
)
allvars <- full_join(allvars, rentdf %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")

housingdf<- getdata("B25003")
housingdf <- housingdf %>% mutate(
  RenterOccupied_A_A = (100*B25003_003E)/B25003_001E,
  RenterOccupied_A_B = (100*B25003B_003E)/B25003B_001E,
  RenterOccupied_A_W = (100*B25003A_003E)/B25003A_001E
)

allvars <- full_join(allvars, housingdf %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")

singlehousingdf <- getdata("S1101", raceavailable = FALSE, subject = TRUE)

##total households S1101_C04_001 and male is S1101_C03_018, female is C04
## so S1101_C04_018* S1101_C04_001 would give total households female single
## and 03 would be male and then could add them up and then divide by sum of total male and female S1101_C04_001
singlehousingdf <- singlehousingdf %>% mutate (
  HH_RenterOccupied_SingleFamily_A_A = 100*((S1101_C03_018E/100* S1101_C03_001E) + (S1101_C04_018E/100* S1101_C04_001E)) / (S1101_C03_001E + S1101_C04_001E),
  HH_RenterOccupied_SingleFamily_M_A = S1101_C03_018E,
  HH_RenterOccupied_SingleFamily_F_A = S1101_C04_018E
)

allvars <- full_join(allvars, singlehousingdf %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")

```

```{r}
car_commutedf <- getdata("B08006", "B08105")
car_commutedf <- car_commutedf %>% mutate (
  Car_truck_van_A_A = (100*B08006_002E)/B08006_001E,
  Car_truck_van_M_A = (100*B08006_020E)/B08006_019E,
  Car_truck_van_F_A = (100*B08006_036E)/B08006_035E,
  Car_truck_van_A_B = (100*B08105B_002E)/B08105B_001E,
  Car_truck_van_A_W = (100*B08105A_002E)/B08105A_001E
)

allvars <- full_join(allvars, car_commutedf %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")

meancommute <- getdata("S0801", raceavailable = FALSE, subject = TRUE)
meancommute <- meancommute %>% mutate (
  Mean_Commute_Time_A_A = S0801_C01_046E
)
allvars <- full_join(allvars, meancommute %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")

results <- getdata("B08012", raceavailable = FALSE, returnvars = TRUE)
commutedf <- results[[1]]
vars <- results[[2]]

lessthan30_all <- paste0("B08012_00", 2:7, "E")
lessthan30_m <- paste0("B08012_0", 15:20, "E")
lessthan30_f <- paste0("B08012_0", 28:33, "E")
range30to60_all <- append(paste0("B08012_00",8:9, "E"),paste0("B08012_0",10:11, "E"))
range30to60_m <- paste0("B08012_0", 21:24, "E")
range30to60_f <- paste0("B08012_0", 34:37, "E")
 
commutedf <- commutedf %>% mutate (
  Less_Than_30_Minutes_A_A = (100*rowSums(across(lessthan30_all)))/B08012_001E,
  Less_Than_30_Minutes_M_A = (100*rowSums(across(lessthan30_m)))/B08012_014E,
  Less_Than_30_Minutes_F_A = (100*rowSums(across(lessthan30_f)))/B08012_027E,
  Range_30_To_60_Minutes_A_A = (100*rowSums(across(range30to60_all)))/B08012_001E,
  Range_30_To_60_Minutes_M_A = (100*rowSums(across(range30to60_m)))/B08012_014E,
  Range_30_To_60_Minutes_F_A = (100*rowSums(across(range30to60_f)))/B08012_027E,
  More_Than_60_Minutes_A_A = (100*(B08012_012E + B08012_013E))/B08012_001E,
  More_Than_60_Minutes_M_A = (100*(B08012_025E + B08012_026E))/B08012_014E,
  More_Than_60_Minutes_F_A = (100*(B08012_038E + B08012_039E))/B08012_027E
)
#commutedf$GEOID<- as.numeric(commutedf$GEOID)
allvars <- full_join(allvars, commutedf %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")


```


##to make sure it doesn't fail on certain vars
```{r}
allvars <- allvars %>% mutate(
FT_Median_Earnings_A_A = 0,
Other_Median_Earnings_A_A = 0
)
```


#occupation data

```{r}
occdf <- getdata("C24010")
#head(occdf)

#tidyoccdf <- occdf[[1]]
#tidyoccdf <- tidyoccdf %>% select("GEOID" | ends_with("E")) #%>% select(!"NAME")

vars <- occdf[1,]
vars

#healthcare

# occdf <- occdf %>% mutate(
#   EmployedWomen = 100*((C24010_038E)/(C24010_001E)),
#   EmployedMen = 100*((C24010_002E)/(C24010_001E))
# )
  
  
occdf <- occdf %>% mutate(
  HealthcareEmployees_A_A = 100*((C24010_016E+C24010_020E+C24010_052E+C24010_056E)/(C24010_001E)),
  HealthcareEmployees_F_A = 100*((C24010_052E+C24010_056E)/(C24010_038E)),
  HealthcareEmployees_M_A = 100*((C24010_016E+C24010_020E)/(C24010_002E)),
  #HealthcareEmployees_F_A_A = 100*((C24010_052E+C24010_056E)/(C24010_016E+C24010_020E+C24010_052E+C24010_056E))
)

# healthcare_female <- occdf %>% select("EmployedWomen" |"EmployedMen"| "HealthcareEmployees_A_A" |"HealthcareEmployees_F_A" | "HealthcareEmployees_F_A_A")
# healthcare_female

#sales and office employees
occdf <- occdf %>% mutate(
  SalesEmployees_A_A = 100*((C24010_027E+C24010_063E)/(C24010_001E)),
  SalesEmployees_F_A = 100*((C24010_063E)/(C24010_038E)), 
  SalesEmployees_M_A = 100*((C24010_027E)/(C24010_002E)),
  SalesEmployees_A_W = 100*((C24010A_005E+C24010A_011E)/(C24010A_002E+C24010A_008E)),
  SalesEmployees_A_B = 100*((C24010B_005E+C24010B_011E)/(C24010B_002E+C24010B_008E)), 
  SalesEmployees_F_W = 100*((C24010A_011E)/(C24010A_008E)), 
  SalesEmployees_F_B = 100*((C24010B_011E)/(C24010B_008E)), 
  SalesEmployees_M_W = 100*((C24010A_005E)/(C24010A_002E)), 
  SalesEmployees_M_B = 100*((C24010B_005E)/(C24010B_002E)) 
)

#management, business, sciences, and arts employees 
occdf <- occdf %>% mutate(
  BusEmployees_A_A = 100*((C24010_003E+C24010_039E)/(C24010_001E)),
  BusEmployees_F_A = 100*((C24010_039E)/(C24010_038E)),
  BusEmployees_M_A = 100*((C24010_003E)/(C24010_002E)),
  BusEmployees_A_W = 100*((C24010A_003E + C24010A_009E)/(C24010A_002E + C24010A_008E)),  
  BusEmployees_A_B = 100*((C24010B_003E + C24010B_009E)/(C24010A_002E + C24010A_008E)),
  BusEmployees_F_W = 100*((C24010A_009E)/(C24010A_008E)),
  BusEmployees_F_B = 100*((C24010B_009E)/(C24010B_008E)),
  BusEmployees_M_W = 100*((C24010A_003E)/(C24010A_002E)),
  BusEmployees_M_B = 100*((C24010B_003E)/(C24010B_002E))
)

#service occupations 
occdf <- occdf %>% mutate(
  ServiceEmployees_A_A = 100*((C24010_019E+C24010_055E)/(C24010_001E)),
  ServiceEmployees_F_A = 100*((C24010_055E)/(C24010_038E)), 
  ServiceEmployees_M_A = 100*((C24010_019E)/(C24010_002E)), 
  ServiceEmployees_A_W = 100*((C24010A_004E+C24010A_010E)/(C24010A_001E)), 
  ServiceEmployees_A_B = 100*((C24010B_004E+C24010B_010E)/(C24010B_001E)), 
  ServiceEmployees_F_W = 100*((C24010A_010E)/(C24010A_008E)), 
  ServiceEmployees_F_B = 100*((C24010B_010E)/(C24010B_008E)), 
  ServiceEmployees_M_W = 100*((C24010A_004E)/(C24010A_002E)), 
  ServiceEmployees_M_B = 100*((C24010B_004E)/(C24010B_002E)) 
)

#natural resources, construction, and maintenance employees
occdf <- occdf %>% mutate(
  ConstructionEmployees_A_A = 100*((C24010_030E+C24010_066E)/(C24010_001E)),
  ConstructionEmployees_F_A = 100*((C24010_066E)/(C24010_038E)),
  ConstructionEmployees_M_A = 100*((C24010_030E)/(C24010_002E)),
  ConstructionEmployees_A_W = 100*((C24010A_006E+C24010A_012E)/(C24010A_002E+C24010A_008E)), 
  ConstructionEmployees_A_B = 100*((C24010B_006E+C24010B_012E)/(C24010B_002E+C24010B_008E)),
  ConstructionEmployees_F_W = 100*((C24010A_012E)/(C24010A_008E)), 
  ConstructionEmployees_F_B = 100*((C24010B_012E)/(C24010B_008E)),
  ConstructionEmployees_M_W = 100*((C24010A_006E)/(C24010A_002E)),
  ConstructionEmployees_M_B = 100*((C24010B_006E)/(C24010B_002E))
)

#food employees 
occdf <- occdf %>% mutate(
  FoodEmployees_A_A = 100*((C24010_024E+C24010_060E)/(C24010_001E)),
  FoodEmployees_F_A = 100*((C24010_060E)/(C24010_038E)),
  FoodEmployees_M_A = 100*((C24010_024E)/(C24010_002E))
)

#production, transportation, and material moving employees 
occdf <- occdf %>% mutate(
  TransportEmployees_A_A = 100*((C24010_030E+C24010_070E)/(C24010_001E)),
  TransportEmployees_F_A = 100*((C24010_070E)/(C24010_038E)),
  TransportEmployees_M_A = 100*((C24010_030E)/(C24010_002E)),
  TransportEmployees_A_W = 100*((C24010A_007E + C24010A_013E)/(C24010A_002E + C24010A_008E)),  
  TransportEmployees_A_B = 100*((C24010B_007E + C24010B_013E)/(C24010B_002E + C24010B_008E)), 
  TransportEmployees_F_W = 100*((C24010A_013E)/(C24010A_008E)), 
  TransportEmployees_F_B = 100*((C24010B_013E)/(C24010B_008E)),
  TransportEmployees_M_W = 100*((C24010A_007E)/(C24010A_002E)),
  TransportEmployees_M_B = 100*((C24010B_007E)/(C24010B_002E)) 
)

allvars <- full_join(allvars, occdf %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")

# male_female_occdf <- occdf %>% select("NAME" | "HealthcareEmployees_M_A" | "HealthcareEmployees_F_A" | "SalesEmployees_M_A" |  "SalesEmployees_F_A" | "BusEmployees_M_A" | "BusEmployees_F_A"  | "ServiceEmployees_M_A" | "ServiceEmployees_F_A" | "ConstructionEmployees_M_A" | "ConstructionEmployees_F_A"| "FoodEmployees_M_A" | "FoodEmployees_F_A" | "TransportEmployees_M_A" | "TransportEmployees_F_A")
# male_female_occdf
# 
# # male_occupation_plot_data <- male_female_occdf %>% pivot_longer(!GEOID, names_to = "Occupation", values_to = "Percent")
# # male_occupation_plot_data
# 
# 
# 
# healthcare_df <- male_female_occdf %>% select ("NAME" | "HealthcareEmployees_M_A" | "HealthcareEmployees_F_A")
# healthcare_df
# 
# plot_width <- 40
# plot_height <- 0.5 * nrow(healthcare_df)
# 
# #plot for healthcare
# healthcare_plot <- ggplot(healthcare_df, aes(x = HealthcareEmployees_M_A, y = NAME)) +
#   # Plot points for percent of men
#   geom_point(aes(color = "Men"), size = 3) +
#   # Plot points for percent of women
#   geom_point(aes(x = HealthcareEmployees_F_A, color = "Women"), size = 3) +
#   # Draw lines between the points for men and women
#   geom_segment(aes(xend = HealthcareEmployees_F_A, yend = NAME), 
#                color = "black", size = 0.25) +
#   # Customize colors for points and lines
#   scale_color_manual(values = c("Men" = "blue", "Women" = "red")) +
#   # Set appropriate labels and titles
#   labs(x = "Percentage", y = "County", 
#        title = "Percent of Men and Women in Healthcare by County") +
#   theme(axis.text.y = element_text(angle = 0, hjust = 0.5)) +
#   theme(plot.title = element_text(hjust = 0.5, size = 30)) +
#   theme(legend.text = element_text(size = 20),
#         legend.title = element_text(size = 15)) +
#   guides(color = guide_legend(override.aes = list(size = 10))) + 
#   theme(axis.text.x = element_text(size = 25),
#         axis.text.y = element_text(size = 15))
# 
# 
# ggsave("healthcare_plot.png", plot = healthcare_plot, width = plot_width, height = plot_height, units = "cm")
# 
# plot_height <- 0.5 * nrow(sales_df)
# 
# sales_df <- male_female_occdf %>% select ("NAME" | "SalesEmployees_M_A" | "SalesEmployees_F_A")
# sales_df
# 
# #plot for sales
# sales_plot <- ggplot(sales_df, aes(x = SalesEmployees_M_A, y = NAME)) +
#   # Plot points for percent of men
#   geom_point(aes(color = "Men"), size = 3) +
#   # Plot points for percent of women
#   geom_point(aes(x = SalesEmployees_F_A, color = "Women"), size = 3) +
#   # Draw lines between the points for men and women
#   geom_segment(aes(xend = SalesEmployees_F_A, yend = NAME), 
#                color = "black", size = 0.25) +
#   # Customize colors for points and lines
#   scale_color_manual(values = c("Men" = "blue", "Women" = "red")) +
#   # Set appropriate labels and titles
#   labs(x = "Percentage", y = "County", 
#        title = "Percent of Men and Women in Sales by County") +
#   theme(axis.text.y = element_text(angle = 0, hjust = 0.5)) +
#   theme(plot.title = element_text(hjust = 0.5, size = 30)) +
#   theme(legend.text = element_text(size = 20),
#         legend.title = element_text(size = 15)) +
#   guides(color = guide_legend(override.aes = list(size = 10))) + 
#   theme(axis.text.x = element_text(size = 25),
#         axis.text.y = element_text(size = 15))
# 
# ggsave("sales_plot.png", plot = sales_plot, width = plot_width, height = plot_height, units = "cm")
# 
# bus_df <- male_female_occdf %>% select ("NAME" | "BusEmployees_M_A" | "BusEmployees_F_A")
# bus_df
# 
# plot_height <- 0.5 * nrow(bus_df)
# 
# #business employees plot 
# bus_plot <- ggplot(bus_df, aes(x = BusEmployees_M_A, y = NAME)) +
#   # Plot points for percent of men
#   geom_point(aes(color = "Men"), size = 3) +
#   # Plot points for percent of women
#   geom_point(aes(x = BusEmployees_F_A, color = "Women"), size = 3) +
#   # Draw lines between the points for men and women
#   geom_segment(aes(xend = BusEmployees_F_A, yend = NAME), 
#                color = "black", size = 0.25) +
#   # Customize colors for points and lines
#   scale_color_manual(values = c("Men" = "blue", "Women" = "red")) +
#   # Set appropriate labels and titles
#   labs(x = "Percentage", y = "County", 
#        title = "Percent of Men and Women in Business Occupations by County") +
#   theme(axis.text.y = element_text(angle = 0, hjust = 0.5)) +
#   theme(plot.title = element_text(hjust = 0.5, size = 30)) +
#   theme(legend.text = element_text(size = 20),
#         legend.title = element_text(size = 15)) +
#   guides(color = guide_legend(override.aes = list(size = 10))) + 
#   theme(axis.text.x = element_text(size = 25),
#         axis.text.y = element_text(size = 15))
# 
# ggsave("business_plot.png", plot = bus_plot, width = plot_width, height = plot_height, units = "cm")
# 
# service_df <- male_female_occdf %>% select ("NAME" | "ServiceEmployees_M_A" | "ServiceEmployees_F_A")
# service_df
# 
# plot_height <- 0.5 * nrow(service_df)
# 
# #plot for service employees 
# service_plot <- ggplot(service_df, aes(x = ServiceEmployees_M_A, y = NAME)) +
#   # Plot points for percent of men
#   geom_point(aes(color = "Men"), size = 3) +
#   # Plot points for percent of women
#   geom_point(aes(x = ServiceEmployees_F_A, color = "Women"), size = 3) +
#   # Draw lines between the points for men and women
#   geom_segment(aes(xend = ServiceEmployees_F_A, yend = NAME), 
#                color = "black", size = 0.25) +
#   # Customize colors for points and lines
#   scale_color_manual(values = c("Men" = "blue", "Women" = "red")) +
#   # Set appropriate labels and titles
#   labs(x = "Percentage", y = "County", 
#        title = "Percent of Men and Women in Service Occupations by County") +
#   theme(axis.text.y = element_text(angle = 0, hjust = 0.5)) +
#   theme(plot.title = element_text(hjust = 0.5, size = 30)) +
#   theme(legend.text = element_text(size = 20),
#         legend.title = element_text(size = 15)) +
#   guides(color = guide_legend(override.aes = list(size = 10))) + 
#   theme(axis.text.x = element_text(size = 25),
#         axis.text.y = element_text(size = 15))
# 
# ggsave("service_plot.png", plot = service_plot, width = plot_width, height = plot_height, units = "cm")
# 
# construction_df <- male_female_occdf %>% select ("NAME" | "ConstructionEmployees_M_A" | "ConstructionEmployees_F_A")
# construction_df
# 
# plot_height <- 0.5 * nrow(construction_df)
# 
# #plot for construction employees 
# construction_plot <- ggplot(construction_df, aes(x = ConstructionEmployees_M_A, y = NAME)) +
#   # Plot points for percent of men
#   geom_point(aes(color = "Men"), size = 3) +
#   # Plot points for percent of women
#   geom_point(aes(x = ConstructionEmployees_F_A, color = "Women"), size = 3) +
#   # Draw lines between the points for men and women
#   geom_segment(aes(xend = ConstructionEmployees_F_A, yend = NAME), 
#                color = "black", size = 0.25) +
#   # Customize colors for points and lines
#   scale_color_manual(values = c("Men" = "blue", "Women" = "red")) +
#   # Set appropriate labels and titles
#   labs(x = "Percentage", y = "County", 
#        title = "Percent of Men and Women in Natural Resource, Construction, and Maintenance Occupations by County") +
#   theme(axis.text.y = element_text(angle = 0, hjust = 0.5)) +
#   theme(plot.title = element_text(hjust = 0.5, size = 20)) +
#   theme(legend.text = element_text(size = 20),
#         legend.title = element_text(size = 15)) +
#   guides(color = guide_legend(override.aes = list(size = 10))) + 
#   theme(axis.text.x = element_text(size = 25),
#         axis.text.y = element_text(size = 15))
# 
# ggsave("construction_plot.png", plot = construction_plot, width = plot_width, height = plot_height, units = "cm")
# 
# food_df <- male_female_occdf %>% select ("NAME" | "FoodEmployees_M_A" | "FoodEmployees_F_A")
# food_df
# 
# plot_height <- 0.5 * nrow(food_df)
# 
# #plot for construction employees 
# food_plot <- ggplot(food_df, aes(x = FoodEmployees_M_A, y = NAME)) +
#   # Plot points for percent of men
#   geom_point(aes(color = "Men"), size = 3) +
#   # Plot points for percent of women
#   geom_point(aes(x = FoodEmployees_F_A, color = "Women"), size = 3) +
#   # Draw lines between the points for men and women
#   geom_segment(aes(xend = FoodEmployees_F_A, yend = NAME), 
#                color = "black", size = 0.25) +
#   # Customize colors for points and lines
#   scale_color_manual(values = c("Men" = "blue", "Women" = "red")) +
#   # Set appropriate labels and titles
#   labs(x = "Percentage", y = "County", 
#        title = "Percent of Men and Women in Food Occupations by County") +
#   theme(axis.text.y = element_text(angle = 0, hjust = 0.5)) +
#   theme(plot.title = element_text(hjust = 0.5, size = 30)) +
#   theme(legend.text = element_text(size = 20),
#         legend.title = element_text(size = 15)) +
#   guides(color = guide_legend(override.aes = list(size = 10))) + 
#   theme(axis.text.x = element_text(size = 25),
#         axis.text.y = element_text(size = 15))
# 
# ggsave("food_plot.png", plot = food_plot, width = plot_width, height = plot_height, units = "cm")
# 
# transport_df <- male_female_occdf %>% select ("NAME" | "TransportEmployees_M_A" | "TransportEmployees_F_A")
# transport_df
# 
# plot_height <- 0.5 * nrow(transport_df)
# 
# #plot for construction employees 
# transport_plot <- ggplot(transport_df, aes(x = TransportEmployees_M_A, y = NAME)) +
#   # Plot points for percent of men
#   geom_point(aes(color = "Men"), size = 3) +
#   # Plot points for percent of women
#   geom_point(aes(x = TransportEmployees_F_A, color = "Women"), size = 3) +
#   # Draw lines between the points for men and women
#   geom_segment(aes(xend = TransportEmployees_F_A, yend = NAME), 
#                color = "black", size = 0.25) +
#   # Customize colors for points and lines
#   scale_color_manual(values = c("Men" = "blue", "Women" = "red")) +
#   # Set appropriate labels and titles
#   labs(x = "Percentage", y = "County", 
#        title = "Percent of Men and Women in Production, Transport, and Moving Occupations by County") +
#   theme(axis.text.y = element_text(angle = 0, hjust = 0.5)) +
#   theme(plot.title = element_text(hjust = 0.5, size = 20)) +
#   theme(legend.text = element_text(size = 20),
#         legend.title = element_text(size = 15)) +
#   guides(color = guide_legend(override.aes = list(size = 10))) + 
#   theme(axis.text.x = element_text(size = 25),
#         axis.text.y = element_text(size = 15))
# 
# ggsave("transport_plot.png", plot = transport_plot, width = plot_width, height = plot_height, units = "cm")
```

#unemployment data
```{r}
#keeps only the estimates
unemployment <- getdata("B23001", "C23002", TRUE) 
head(unemployment)

#unsure about the purpose of these lines it seems the same either way
tidyunemploymentdf <- unemployment[[1]]
#tidyunemploymentdf <- tidyunemploymentdf %>% select("GEOID" | ends_with("E")) %>% select(!"NAME")

vars <- unemployment[[2]]
vars

filtervars <- function (variables, searchname, searchtext, removetext="") {
  filteredvars <- variables %>% filter(str_detect(name, searchname))
  for (text in searchtext) {
    filteredvars <- filteredvars %>% filter(str_detect(label, text))
  }
  if (removetext != "") {
    filteredvars <- filteredvars %>% filter(!str_detect(label, removetext))
  }
  return (filteredvars$name)
}

all_unemployed <- filtervars(vars, "B23001", c("Unemployed")) #all_unemployed
all_unemployed_m <- filtervars(vars, "B23001", c("Unemployed", "Male")) #unemployed male
all_unemployed_f <- filtervars(vars, "B23001", c("Unemployed", "Female")) #unemployed female
all_unemployed_w <- filtervars(vars, "C23002A", c("Unemployed")) #unemployed white people
all_unemployed_b <- filtervars(vars, "C23002B", c("Unemployed")) #unemployed black people
all_unemployed_fw <- filtervars(vars, "C23002A", c("Unemployed", "Female")) #unemployed white women
all_unemployed_fb <- filtervars(vars, "C23002B", c("Unemployed", "Female")) #unemployed black women
all_unemployed_mw <- filtervars(vars, "C23002A", c("Unemployed", "Male")) #unemployed white men
all_unemployed_mb <- filtervars(vars, "C23002B", c("Unemployed", "Male")) #unemployed black men

#denominators start here
all_labor_force <- filtervars(vars, "B23001", c("In labor force:"), c("In labor force:!!")) #everyone
all_labor_force_m <- filtervars(vars, "B23001", c("In labor force:", "Male"), "In labor force:!!") #male
all_labor_force_f <- filtervars(vars, "B23001", c("In labor force:", "Female"), "In labor force:!!") #female
all_labor_force_w <- filtervars(vars, "C23002A", c("In labor force:"), "In labor force:!!") #white
all_labor_force_b <- filtervars(vars, "C23002B", c("In labor force:"), "In labor force:!!") # black
all_labor_force_mw <- filtervars(vars, "C23002A", c("In labor force:", "Male"), "In labor force:!!") #white men
all_labor_force_mb <- filtervars(vars, "C23002B", c("In labor force:", "Male"), "In labor force:!!")
all_labor_force_fw <- filtervars(vars, "C23002A", c("In labor force:", "Female"), "In labor force:!!")
all_labor_force_fb <- filtervars(vars, "C23002B", c("In labor force:", "Female"), "In labor force:!!")


#Add E to everything 
result <- lapply(list(all_unemployed, all_unemployed_m, all_unemployed_f, all_unemployed_w, all_unemployed_b, all_unemployed_fw, all_unemployed_fb, all_unemployed_mw, all_unemployed_mb), paste_e)
result

result2 <- lapply(list(all_labor_force, all_labor_force_m, all_labor_force_f, all_labor_force_w, all_labor_force_b, all_labor_force_fw, all_labor_force_fb, all_labor_force_mw, all_labor_force_mb), paste_e)
result2 # list 


#rename and calculate percentages
tidyunemploymentdf
tidyunemploymentdf <- tidyunemploymentdf %>% mutate(
  Unemployment_Rate_A_A = 100*((rowSums(across(result[[1]])))/(rowSums(across(result2[[1]])))),
  Unemployment_Rate_M_A = 100*((rowSums(across(result[[2]])))/(rowSums(across(result2[[2]])))),
  Unemployment_Rate_F_A = 100*((rowSums(across(result[[3]])))/(rowSums(across(result2[[3]])))),
  Unemployment_Rate_A_W = 100*((rowSums(across(result[[4]])))/(rowSums(across(result2[[4]])))),
  Unemployment_Rate_A_B = 100*((rowSums(across(result[[5]])))/(rowSums(across(result2[[5]])))),
  Unemployment_Rate_F_W = 100*((rowSums(across(result[[6]])))/(rowSums(across(result2[[6]])))),
  Unemployment_Rate_F_B = 100*((rowSums(across(result[[7]])))/(rowSums(across(result2[[7]])))),
  Unemployment_Rate_M_W = 100*((rowSums(across(result[[8]])))/(rowSums(across(result2[[8]])))),
  Unemployment_Rate_M_B = 100*((rowSums(across(result[[9]])))/(rowSums(across(result2[[9]]))))
)

allvars <- full_join(allvars, tidyunemploymentdf %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")
```

#population data 
```{r}
population_estimates <- getdata("B01001")
#used the rows for total estimates by race or gender, disregarded age ranges - adults and children are included  
population_estimates <- population_estimates %>% mutate(
  Population_A_A = B01001_001E, #all genders and races
  Population_M_A = B01001_002E, #male only all races
  Population_F_A = B01001_026E, #female only and all races
  Population_A_W = 100*(B01001A_001E/B01001_001E), #all genders and white only
  Population_A_B = 100*(B01001B_001E/B01001_001E), #all genders and black only 
  # Population_M_W = B01001A_002E, #male and white only
  # Population_M_B = B01001B_002E, #male and black only
  # Population_F_W = B01001A_017E, #female and white only 
  # Population_F_B = B01001B_017E #female and black only 
)

# population_estimates$Population_M_A / population_estimates$Population_A_A
# population_estimates$Population_M_B / population_estimates$Population_A_B
# population_estimates %>% filter(Population_M_B/Population_A_B > .7) #Green and Issaquena have a higher percent of men

allvars <- full_join(allvars, population_estimates %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")

```


#single households data
```{r}
single_households <- getdata("B11001", subject=TRUE)
head(single_households)

#find definition 

#probably needs to be redone, S1101 contains percentages 

single_households <- single_households %>% mutate(
  HH_SingleFamily_A_A = 100*(B11001_004E/B11001_001E),
  HH_SingleFamily_M_A = 100*(B11001_005E/B11001_004E),
  HH_SingleFamily_F_A = 100*(B11001_006E/B11001_004E),
  HH_SingleFamily_A_W = 100*(B11001A_004E/B11001A_001E),
  HH_SingleFamily_A_B = 100*(B11001B_004E/B11001B_001E),
  HH_SingleFamily_M_W = 100*(B11001A_005E/B11001A_004E),
  HH_SingleFamily_M_B = 100*(B11001B_005E/B11001B_004E),
  HH_SingleFamily_F_W = 100*(B11001A_006E/B11001A_004E),
  HH_SingleFamily_F_B = 100*(B11001B_006E/B11001B_004E)
)

allvars <- full_join(allvars, single_households %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")

```

#single households with minors
```{r}
singlehouseholds_minors <- getdata("S2201", raceavailable=FALSE, subject=TRUE)

#not sure what's possibly wrong here, need to ask Fatima  
singlehouseholds_minors <- singlehouseholds_minors %>% mutate(
  HH_W.MinorsSingleFamily_A_A = 100*(S2201_C01_011E/S2201_C01_001E),
  HH_W.MinorsSingleFamily_F_A = 100*(S2201_C01_013E/S2201_C01_011E),
  HH_W.MinorsSingleFamily_M_A = 100*(S2201_C01_012E/S2201_C01_011E)
)

allvars <- full_join(allvars, singlehouseholds_minors %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")

```

#families on gov programs data
```{r}
#unsure, this says universe: needs to be changed?
govprograms <- getdata("B09010", raceavailable = FALSE)
#head(govprograms)
#rows 3-6 all family households on SSI
#rows 9-12 all family households NOT on SSI
govprograms <- govprograms %>% mutate(
  HHOnGovPrograms_Family_A_A = 100*((B09010_003E)/(B09010_003E+B09010_009E)),
  HHOnGovPrograms_Family_F_A = 100*((B09010_006E)/(B09010_003E)),
  HHOnGovPrograms_Family_M_A = 100*((B09010_005E)/(B09010_003E))
)

# #make histogram of these three variables
# ggplot(govprograms_familyhouseholds, aes(x = HHOnGovPrograms_Family_A_A)) + geom_histogram(fill="blue", color="black", bins=30)
# ggplot(govprograms_familyhouseholds, aes(x = HHOnGovPrograms_Family_F_A)) + geom_histogram(fill="red", color="black", bins=30)
# ggplot(govprograms_familyhouseholds, aes(x = HHOnGovPrograms_Family_M_A)) + geom_histogram(fill="purple", color="black", bins=30)

allvars <- full_join(allvars, govprograms %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")

```

#single households on SNAP
```{r}
single_households_SNAP <- getdata("S2201", raceavailable=FALSE, subject=TRUE)
head(single_households_SNAP)

single_households_SNAP <- single_households_SNAP %>% mutate(
  HHOnSNAP_SingleFamily_A_A = 100*(S2201_C03_005E/S2201_C01_005E),
  HHOnSNAP_SingleFamily_M_A = 100*(S2201_C03_006E/S2201_C01_006E),
  HHOnSNAP_SingleFamily_F_A = 100*(S2201_C03_007E/S2201_C01_007E)
)

allvars <- full_join(allvars, single_households_SNAP %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")

```

#single households with minors on SNAP
```{r}
singlehouseholds_minors_SNAP <- getdata("S2201", raceavailable=FALSE, subject=TRUE)

#not sure, this might be wrong
singlehouseholds_minors_SNAP <- singlehouseholds_minors_SNAP %>% mutate(
  HHOnSNAP_W.MinorsSingleFamily_A_A = 100*(S2201_C03_011E/S2201_C01_011E),
  HHOnSNAP_W.MinorsSingleFamily_M_A = 100*(S2201_C03_012E/S2201_C01_012E),
  HHOnSNAP_W.MinorsSingleFamily_F_A = 100*(S2201_C03_013E/S2201_C01_013E)
)

allvars <- full_join(allvars, singlehouseholds_minors_SNAP %>% select(matches("_A|_B|_W|GEOID")), by="GEOID")

```

#renter-occupied housing
```{r}
renters <- getdata("B25008", "B25003")
head(renters)
# 
# #percentages
# renters <- renters %>% mutate(
#   RenterOccupied_A_A = 100*(B25008_003E/B25008_001E),
#   Renter_Occupied_A_W = 100*(B25003A_003E/B25003A_001E),
#   Renter_Occupied_A_B = 100*(B25003B_003E/B25003B_001E)
# )

```
#median rent
```{r}
# median_rent <- getdata("B25064", raceavailable=FALSE)
# median_rent <- median_rent %>% mutate(
#   Median_Rent_A_A <- B25064_001E
# )
```
#single household renter
```{r}
#single_household_renters <- getdata("S1101", raceavailable=FALSE, subject=TRUE)
# 
# #find out if this includes married couples or not (contradiction between subtab and variable name)
# single_household_renters <- single_household_renters %>% mutate(
#   HH_RenterOccupied_SingleFamily_A_A = 100*((S1101_C03_018E+S1101_C04_018E)/S1101_C01_018E),
#   HH_RenterOccupied_SingleFamily_M_A = 100*((S1101_C03_018E)/(S1101_C03_018E+S1101_C04_018E)),
#   HH_RenterOccupied_SingleFamily_F_A = 100*((S1101_C04_018E)/(S1101_C03_018E+S1101_C04_018E))
# )
```


```{r}
#library(rjson)

olddata <- read.csv(file = "../Data_COMPLETE_cleaned_20210302.csv")
olddata <- olddata %>% rename(TANFPayment_A_A = Total_TANFPayment)
allvars$GEOID <- as.numeric(allvars$GEOID)
combineddata <- full_join(olddata, allvars, by=c("Id2" = "GEOID") )

jsonlite::write_json(combineddata, "../src/data/Data_2023_08_02.json")
```


